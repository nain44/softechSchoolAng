<!DOCTYPE html>
<html lang="en" ng-app="school">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title ng-bind="title"></title>
    <!-- core:css -->
    <link rel="stylesheet" href="assets/vendors/core/core.css">
    <!-- endinject -->

    <!-- plugin css for this page -->
    <link rel="stylesheet" href="assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.css">
    <link rel="stylesheet" href="assets/vendors/select2/select2.min.css">
    <link rel="stylesheet" href="assets/vendors/jquery-tags-input/jquery.tagsinput.min.css">
    <link rel="stylesheet" href="assets/vendors/dropzone/dropzone.min.css">
    <link rel="stylesheet" href="assets/vendors/dropify/dist/dropify.min.css">
    <link rel="stylesheet" href="assets/vendors/bootstrap-colorpicker/bootstrap-colorpicker.min.css">
    <link rel="stylesheet" href="assets/vendors/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/vendors/tempusdominus-bootstrap-4/tempusdominus-bootstrap-4.min.css">
    <!-- end plugin css for this page -->
    <!--Ex-Editable-->
    <link href="assets/xeditable-0.10.0/css/xeditable.min.css" rel="stylesheet" />

    <!-- inject:css -->
    <link rel="stylesheet" href="assets/fonts/feather-font/css/iconfont.css">
    <!-- endinject -->

    <!-- Layout styles -->
    <link rel="stylesheet" href="assets/css/demo_1/style.css">
    <link rel="stylesheet" href="assets/css/demo_1/icon.css">
    <link rel="stylesheet" href="assets/css/demo_1/design.css">
    <link rel="stylesheet" href="assets/css/demo_1/custom.css">
    <link rel="stylesheet" href="assets/css/demo_1/themify-icons.css">
    <link rel="stylesheet" href="assets/css/demo_1/bootstrap-material-datetimepicker.css">
    <!-- <link rel="stylesheet" href="assets/css/demo_1/themify-icons.css"> -->
    <!-- End layout styles -->
    <link rel="shortcut icon" href="assets/images/favicon.png" />
    <!-- Global site tag (gtag.js) - Google Analytics start -->
    <script async src="assets/js/js.js"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-146586338-1');
    </script>
    <!-- Google Analytics end -->
</head>

<body class="sidebar-dark" ng-controller="main-ct">
    <div class="main-wrapper">
       

        <div class="page-wrapper">
           
            <div class="page-content">
                <!-- START PAGE CONTENT-->
               
               
    
<div class="row">
    <div class="col-12 col-xl-12 grid-margin stretch-card">
        <div class="card overflow-hidden">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-baseline mb-4 mb-md-3">
                    <h6 class="card-title mb-0">Send Sms</h6>
                </div>
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <form class="form-inline">
                            <!-- <select ng-options="item.cls_title for item in getAllClasses track by item.cls_id" class="form-control input col-md-2" ng-model="srch.classId" ng-change="getAllStudentsContactsFunc(srch.classId.cls_id)">
                                <option value="" selected="">Select Class</option>
                            </select> -->
                            <select ng-options="item.cls_title for item in getAllClasses track by item.cls_id" class="form-control input col-md-2" ng-change="getSections(srch.classId.cls_id)" ng-model="srch.classId">
                                <option value="" selected="">Select Class</option>
                            </select>
                            <select ng-options="item.sec_title for item in dataSection track by item.sec_id" class="form-control input col-md-2" ng-model="srch.section"ng-change="getAllStudentsContactsFunc(srch.classId.cls_id)" >
                                <option value="" selected=""> Select Section</option>
                            </select>
                            <button class="form-control input col-md-2" ng-click="selectSubjects()">Select Student(s)</button> 
                            <button class="btn btn-danger input mb-2" ng-click="clearData()" href=""><i class="ti-brush"></i> Clear</button>
                        </form>
                        <div class="tbl-mlmis text-capitalize">
                            <textarea ng-model="sms.smsContent" id="smsC" rows="6" cols="70" >

                            </textarea><br>
                            <button class="btn btn-blue input mb-2" ng-click="sendSmsFunc(sms)"><i class="text-primary" aria-hidden="true"></i> Send</button>
                            <button class="btn btn-danger input mb-2" ng-click="clearData()" href=""><i class="ti-brush"></i> Clear</button>

                        </div>
                        <div ng-show="loadingdata" style="margin-top: 50px" class="d-flex justify-content-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="sr-only">Loading...</span>
                             </div>
                        </div>
                    </div>
                    <div class="modal fade" id="selectSubjects" role="dialog" style="z-index:1060;">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header btn-info">
                                    <h6>
                                        <span>Students</span>&nbsp;&nbsp;&nbsp;
                                    </h6>
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>
                                
                                <div class="modal-body">
                                      <form class="form-inline input">
                                        </form>
                                        <div class="modal-footer btn-info">
                                            <input type="text" name="search" class="form-control"  placeholder="Search Student" ng-model="Searchstd">

                                            <button type="button" class="btn btn-primary" data-dismiss="modal">
                                                   Save
                                               </button>
                                               <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="clear()">
                                                   <span> Cancel </span>
                                               </button>
                                           </div>
                                    <form id="Edit-Class" class="Edit-Class form-inline">
                                      
                                           <table class="table table-bordered table-hover" id="" cellspacing="0">
                                            <thead class="thead-default">
                                                <tr>
                                                    <th>
                                                        Select All<br />
                                                        <input type="checkbox" id="cat1main" ng-change="checkall1()" ng-model="object2.selected1" />
                                                    </th>
                                                    <th>Students</th> 
                                                    <th>Class</th>

                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="text-capitalize" ng-repeat="std in dataStd| filter:Searchstd">
                                                    <td>
                                                        <input type="checkbox" id="check{{std.std_id}}" ng-model="seletedones[std.std_id]" ng-change="selectchecked()" />
                                                    </td>
                                                    <td>
                                                        <span ng-if="std.std_name   ">{{std.std_name}} / {{std.std_fName}}</span>
                                                    </td><td>
                                                        <span ng-if="std.cls_title   ">{{std.cls_title}}</span>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </form>
                                </div>
                                <div class="modal-footer btn-info">
                                 <button type="button" class="btn btn-primary" data-dismiss="modal">
                                        Save
                                    </button>
                                    <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="clear()">
                                        <span> Cancel </span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<!-- END PAGE CONTENT-->
</div>

<!-- partial:partials/_footer.html -->
<footer class="footer d-flex flex-column flex-md-row align-items-center justify-content-between d-print-none">
<p class="text-muted text-center text-md-left">Copyright Â© 2019 <a href="https://www.softechschool.com" target="_blank">Softech School</a>. All rights reserved</p>
</footer>
<!-- partial -->

</div>
</div>
<script src="assets/js/datepicker.js"></script>


    <!-- core:js -->
    <script src="assets/vendors/core/core.js"></script>
    <!-- endinject -->
    <!-- plugin js for this page -->
    <script src="assets/vendors/jquery-validation/jquery.validate.min.js"></script>
    <script src="assets/vendors/bootstrap-maxlength/bootstrap-maxlength.min.js"></script>
    <script src="assets/vendors/inputmask/jquery.inputmask.bundle.min.js"></script>
    <script src="assets/vendors/select2/select2.min.js"></script>
    <script src="assets/vendors/typeahead.js/typeahead.bundle.min.js"></script>
    <script src="assets/vendors/jquery-tags-input/jquery.tagsinput.min.js"></script>
    <script src="assets/vendors/dropzone/dropzone.min.js"></script>
    <script src="assets/vendors/dropify/dist/dropify.min.js"></script>
    <script src="assets/vendors/bootstrap-colorpicker/bootstrap-colorpicker.min.js"></script>
    <script src="assets/vendors/moment/moment.min.js"></script>
    <script src="assets/vendors/tempusdominus-bootstrap-4/tempusdominus-bootstrap-4.js"></script>
    <script src="assets/vendors/chartjs/Chart.min.js"></script>
    <script src="assets/vendors/jquery.flot/jquery.flot.js"></script>
    <script src="assets/vendors/jquery.flot/jquery.flot.resize.js"></script>
    <script src="assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
    <script src="assets/vendors/apexcharts/apexcharts.min.js"></script>
    <script src="assets/vendors/progressbar.js/progressbar.min.js"></script>
    <script src="assets/vendors/tinymce/plugins/print/plugin.min.js"></script>

    <!-- end plugin js for this page -->
    <!-- inject:js -->
    <script src="assets/vendors/feather-icons/feather.min.js"></script>
    <script src="assets/js/template.js"></script>
    <!-- endinject -->
    <!-- custom js for this page -->
    <script src="assets/js/form-validation.js"></script>
    <script src="assets/js/bootstrap-maxlength.js"></script>
    <script src="assets/js/inputmask.js"></script>
    <script src="assets/js/select2.js"></script>
    <script src="assets/js/typeahead.js"></script>
    <script src="assets/js/tags-input.js"></script>
    <script src="assets/js/dropzone.js"></script>
    <script src="assets/js/dropify.js"></script>
    <script src="assets/js/bootstrap-colorpicker.js"></script>

    <script src="assets/js/timepicker.js"></script>
    <script src="assets/js/dashboard.js"></script>
    <script src="assets/js/bootstrap-material-datetimepicker.js"></script>
    <script src="assets/js/bootstrap-datepicker.min.js"></script>
    <script src="assets/js/bootstrap-datetimepicker.min.js"></script>
    <script src="assets/js/ripples.min.js"></script>
    <script src="assets/js/material.min.js"></script>
    <script src="assets/js/moment-with-locales.min.js"></script>
    <!-- end custom js for this page -->
    <!-- Angularjs-->
    <script src="angular/angular.min.js"></script>
    <script src="angular/angular-ui-router.min.js"></script>
    <script src="assets/xeditable-0.10.0/js/xeditable.min.js"></script>
    
    


</body>

</html>
<script>
    var app = angular.module("school", ["ui.router", "xeditable"])

app.controller("sendSms-ct", ['$scope', '$state', '$scope', '$window', 'serF', function ($scope, $state, $window, serF) {
    
        // if ($scope.userId == null || $scope.userId == undefined) {
        //     location.assign("../user")
        // }
    
        var ndate = new Date();
        var dd = ndate.getDate();
        var mm = ndate.getMonth() + 1;
        var yyyy = ndate.getFullYear();
        var hh = ndate.getHours();
        var mni = ndate.getMinutes();
        var ss = ndate.getSeconds();
        var today = yyyy + '-' + mm + '-' + dd + ' ' + hh + ':' + mni + ':' + ss;
    
        ////////////////////// Date Picker \\\\\\\\\\\\\\\\\\\\
    
        $("#datepickerM").datepicker({
            format: "mm",
            viewMode: "months",
            minViewMode: "months",
            autoclose: true,
        });
    
        $("#datepickerEM").datepicker({
            format: "mm",
            viewMode: "months",
            minViewMode: "months",
            autoclose: true,
        });
    
        $("#datepickerd").datepicker({
    
    
            autoclose: true,
        });
    
    
        ////////////////////// Date Picker End \\\\\\\\\\\\\\\\\\\\
    
        /////////////////////// Date Picker Start \\\\\\\\\\\\\\\\\\\\\\\\
        $('#enddate').bootstrapMaterialDatePicker({
            format: 'YYYY-MM-DD',
            weekStart: 1,
            time: false
        });
        $('#startdate').bootstrapMaterialDatePicker({
            format: 'YYYY-MM-DD',
            weekStart: 1,
            time: false
        }).on('change', function (e, date) {
            $('#enddate').bootstrapMaterialDatePicker('setMinDate', date);
        });
    
        ////////////////////// Date Picker End \\\\\\\\\\\\\\\\\\\\
    
        //get current month and year
        var d = new Date();
        var cMonth = d.getMonth() + 1;
        var cYear = d.getFullYear();
        //------------- Get All Fees -------------
        $scope.src = {};
        $scope.spinnerAllFees = false;
        $scope.loadingdata = false;
    
        var srchObj = {
            day: today,
    
        };
    
       
      
        $scope.object1 = {};
        $scope.object2 = {};
        $scope.seletedones = [];
        $scope.seleteditems = [];
        $scope.checkall1 = function () {
    
            $scope.seleteditems = [];
            angular.forEach($scope.dataStd, function (cate1) {
    
                console.log(cate1, "cate1", $scope.object2.selected1, "obje2")
    
                $scope.seletedones[cate1.std_id] = $scope.object2.selected1;
                if ($scope.object2.selected1 == false || $scope.object2.selected1 == undefined) {
                    $scope.seleteditems = [];
                }
                if ($scope.seletedones[cate1.std_id] == true) {
                    
                    $scope.seleteditems.push(cate1.std_fContact);
    
                }
    
            });
    
        }
        $scope.selectchecked = function () {
            $scope.seleteditems = [];
            $scope.count = 0;
            angular.forEach($scope.dataStd, function (cate1) {
    
                if ($scope.seletedones[cate1.std_id] == true) {
                    $scope.seleteditems.push(cate1.std_fContact);
    
                }
                else {
                    $scope.object2.selected1 = false;
                }
            });
    
        }
         $scope.srch = {}   
        $scope.comArr =[]
        $scope.addStdToSectionFunc = function () {
            angular.forEach($scope.seleteditems, function (v, k) {       
            $scope.spinner = true;
        //    console.log(" $scope.sec.section.sec_id", $scope.sec.section.sec_id)
            var param = {
    
                "schId": $scope.userId,
                "stdId": v,
                "secId": $scope.sec.section.sec_id,
                'secTitle': $scope.sec.section.sec_title
            };
                
            var serviceData = serF.serverCall(param, $scope.addStdToSection);
            serviceData.then(function (result) {
                $scope.spinner = false;
                $scope.updateStdFeeArr = result.data.data;
                $state.reload();
            }, function myError(response) {
                console.log('Failed to load data')
                $scope.res_data = response.statusText;
            });
            })
        }
       
        $scope.getAllClass = function () {
    
            var param = { 'schId': $scope.userId }
            var serviceData = serF.serverCall(param, $scope.GetAllClasses);
    
            serviceData.then(function (result) {
    
                $scope.getAllClasses = result.data.data;
    
            }, function myError(response) {
                console.log('Failed to load data')
            });
        }
        $scope.getAllClass();
        $scope.getallStudentsFunc = function () {
            
            $scope.loadingdata = true;
    
           
                var param = {
                    "schId": $scope.userId
                }
                if ($scope.srch != undefined && $scope.srch != "" && $scope.srch.classId!=undefined) { param["classId"] = $scope.srch.classId.cls_id; }
                if ($scope.srch != undefined && $scope.srch != "" ) { param["stdId"] = $scope.srch.stdId; }
                if ($scope.srch != undefined && $scope.srch != "" && $scope.srch.section!=undefined) { param["secId"] = $scope.srch.section.sec_id; }
            var serviceData = serF.serverCall(param, $scope.GetAllStudent);
    
            serviceData.then(function (result) {
              
                $scope.loadingdata = false;
                $scope.dataStd = result.data.data;
                $scope.seleteditems=$scope.dataStd;
               
            }, function myError(response) {
                console.log('Failed to load data')
                //$scope.res_data = response.statusText;
            });
        }
        $scope.getSections = function (clsId) {
            
                    $scope.loadingdata = true;
            
                    var param = {
                        'schId': $scope.userId
                    }
                    if (clsId) { param["classId"] = clsId; }
            
                    var serviceData = serF.serverCall(param, $scope.getClassSection);
            
                    serviceData.then(function (result) {
            
                        $scope.loadingdata = false;
                        $scope.dataSection = result.data.data;
            
                    }, function myError(response) {
                        console.log('Failed to load data')
                    });
                }
        $scope.getAllStudentsContactsFunc = function () {
            
            $scope.loadingdata = true;
           
           
                var param = {
                    "schId": $scope.userId
                }
                if ($scope.srch != undefined && $scope.srch != "" && $scope.srch.classId!=undefined) { param["classId"] = $scope.srch.classId.cls_id; }
                if ($scope.srch != undefined && $scope.srch != "" ) { param["stdId"] = $scope.srch.stdId; }
                if ($scope.srch != undefined && $scope.srch != "" && $scope.srch.section!=undefined) { param["secId"] = $scope.srch.section.sec_id; }
            var serviceData = serF.serverCall(param, $scope.getAllStudentsContacts);
    
            serviceData.then(function (result) {
              
                $scope.loadingdata = false;
                $scope.dataStdcont = result.data.data;
               angular.forEach($scope.dataStdcont,function(k,v){
                $scope.seleteditems.push(k.std_fContact)
    
    
               } )
               {
    
               }
            }, function myError(response) {
                console.log('Failed to load data')
                //$scope.res_data = response.statusText;
            });
        }
        $scope.selectSubjects = function () {
            $scope.getallStudentsFunc();
           $('#selectSubjects').modal();
       }
    
    
       $scope.sendSmsFunc=function(sms){
        var param = {
            
             "msgContent": sms.smsContent,
             "numbers": $scope.seleteditems
         }        
          console.log(param)
               var serviceData = serF.serverCall(param, $scope.sendSms);
               serviceData.then(function (result) {
                 $scope.obtMArr = []; 
               })            
                  
                 
            
       }
       $scope.clearData = function () {
        $state.reload();
        $scope.sms = "";
    }
    
    }]);
</script>